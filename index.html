<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bongo Token Hunter - Arcade Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
        }
        
        #game-container {
            background-color: #161b22;
            border-radius: 1.5rem;
            box-shadow: 0 0 30px rgba(0, 255, 170, 0.2);
            padding: 1rem;
            max-width: 550px;
            width: 100%;
        }
        
        #gameCanvas {
            border: 3px solid #00f3a6;
            border-radius: 0.75rem;
            background-color: #0b0f14;
            display: block;
            width: 100%;
            height: 400px;
            margin-bottom: 1rem;
        }
        
        .control-button {
            transition: all 0.1s ease;
            box-shadow: 0 0 8px rgba(0, 255, 170, 0.7);
        }
        
        .control-button:active {
            box-shadow: 0 0 5px rgba(0, 255, 170, 0.9);
            transform: scale(0.98);
            background-color: #00ffaa;
        }
        
        .ui-button {
            transition: transform 0.1s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        
        .ui-button:active {
            transform: scale(0.98);
        }
        
        .hidden {
            display: none !important;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        .game-over {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1 class="text-3xl font-extrabold text-center text-[#00f3a6] mb-4">Bongo Token Hunter</h1>
        
        <div id="loadingMessage" class="text-center text-white p-4">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-[#00f3a6]"></div>
            <p class="mt-2">Loading Game Assets...</p>
        </div>
        
        <div id="game-ui" class="hidden">
            <div class="grid grid-cols-3 gap-2 mb-4 text-white font-bold text-lg p-2 bg-[#21262d] rounded-lg">
                <p class="text-blue-400">Level: <span id="currentLevel">1</span></p>
                <p class="text-[#ffcc00] text-center">Score: <span id="currentScore">0</span></p>
                <p class="text-[#00f3a6] text-right">High Score: <span id="highScore">0</span></p>
            </div>
            
            <div class="flex justify-between items-center mb-4 text-white font-bold text-sm p-2 bg-[#313a46] rounded-lg border border-red-400">
                <p class="text-gray-300">Tokens: <span id="sessionTokens" class="font-extrabold text-red-400">0</span></p>
                <p class="text-red-400">Total: <span id="totalTokens">0</span></p>
            </div>

            <canvas id="gameCanvas" width="500" height="400"></canvas>
            
            <p class="text-center text-gray-400 text-sm mb-4">Move Bongo to collect coins automatically!</p>

            <div class="flex justify-between items-center p-3">
                <div id="d-pad" class="grid grid-cols-3 grid-rows-3 gap-1 w-40 h-40">
                    <button data-dir="up" class="control-button col-start-2 row-start-1 bg-[#00ffaa] text-gray-900 font-bold rounded-lg">UP</button>
                    <button data-dir="left" class="control-button col-start-1 row-start-2 bg-[#00ffaa] text-gray-900 font-bold rounded-lg">LEFT</button>
                    <div class="col-start-2 row-start-2 flex items-center justify-center text-xs text-gray-500">MOVE</div>
                    <button data-dir="right" class="control-button col-start-3 row-start-2 bg-[#00ffaa] text-gray-900 font-bold rounded-lg">RIGHT</button>
                    <button data-dir="down" class="control-button col-start-2 row-start-3 bg-[#00ffaa] text-gray-900 font-bold rounded-lg">DOWN</button>
                </div>

                <div class="flex flex-col space-y-3 w-40 h-40 justify-center items-center">
                    <button id="startButton" class="ui-button bg-[#ffcc00] text-gray-900 font-extrabold py-3 px-6 rounded-xl uppercase w-full">
                        START GAME
                    </button>
                </div>
            </div>

            <div class="mt-8 p-4 bg-[#21262d] rounded-xl border border-blue-500">
                <h3 class="text-xl font-bold text-blue-400 mb-4 text-center">Token Vault</h3>
                <div class="mb-4">
                    <input type="text" id="solanaAddress" placeholder="Solana Address" class="w-full p-2 bg-[#0d1117] text-white border border-gray-600 rounded-lg">
                </div>
                <div class="mb-4">
                    <input type="number" id="withdrawalAmount" placeholder="100" min="100" class="w-full p-2 bg-[#0d1117] text-white border border-gray-600 rounded-lg">
                </div>
                <button id="withdrawButton" class="ui-button bg-blue-600 text-white font-extrabold py-3 px-6 rounded-xl uppercase w-full">
                    Withdraw Tokens
                </button>
                <p id="withdrawalMessage" class="text-center mt-3 text-sm h-5"></p>
            </div>
        </div>

        <div id="gameOverModal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden justify-center items-center p-4">
            <div class="bg-[#1e2a36] p-8 rounded-2xl text-center max-w-sm w-full border-4 border-red-500 game-over">
                <h2 class="text-4xl font-black text-red-500 mb-4">GAME OVER!</h2>
                <p class="text-xl text-white mb-2">Score: <span id="finalScore" class="font-extrabold text-[#ffcc00]">0</span></p>
                <p class="text-xl text-white mb-4">Tokens: <span id="finalSessionTokens" class="font-extrabold text-red-400">0</span></p>
                <p class="text-xl text-white mb-6">High Score: <span id="newHighScore" class="font-extrabold text-[#00f3a6]">0</span></p>
                <button id="restartButton" class="ui-button bg-red-600 text-white font-extrabold py-3 px-8 rounded-xl uppercase text-lg">
                    Play Again
                </button>
            </div>
        </div>

        <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden justify-center items-center p-4">
            <div class="bg-[#1e2a36] p-8 rounded-2xl text-center max-w-sm w-full border-4 border-yellow-500">
                <h2 id="modalTitle" class="text-3xl font-black text-yellow-500 mb-4">Alert</h2>
                <p id="modalBody" class="text-lg text-white mb-6">Message</p>
                <button id="closeModalButton" class="ui-button bg-yellow-600 text-gray-900 font-extrabold py-3 px-8 rounded-xl uppercase text-lg">
                    OK
                </button>
            </div>
        </div>
    </div>

    <script>
        // SIMPLE VERSION THAT WILL DEFINITELY WORK
        console.log("Game script loaded!");
        
        // Wait for page to fully load
        window.addEventListener('load', function() {
            console.log("Page fully loaded, starting game...");
            initializeGame();
        });

        function initializeGame() {
            console.log("Initializing game...");
            
            // Get DOM elements
            const loadingMessage = document.getElementById('loadingMessage');
            const gameUI = document.getElementById('game-ui');
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // Show game UI immediately
            loadingMessage.classList.add('hidden');
            gameUI.classList.remove('hidden');
            console.log("Game UI should be visible now!");
            
            // Initialize game state
            let gameRunning = false;
            let score = 0;
            let level = 1;
            let sessionTokens = 0;
            let highScore = localStorage.getItem('bongoHighScore') || 0;
            let totalTokens = localStorage.getItem('bongoTotalTokens') || 0;
            
            // Update displays
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('totalTokens').textContent = totalTokens;
            
            // Player object
            const player = {
                x: canvas.width / 2 - 20,
                y: canvas.height - 80,
                width: 40,
                height: 60,
                speed: 5,
                moveDirection: { up: false, down: false, left: false, right: false }
            };
            
            // Game objects
            let bullets = [];
            let coins = [];
            
            // Set up event listeners
            setupEventListeners();
            
            // Draw initial screen
            draw();
            
            function setupEventListeners() {
                // Start button
                document.getElementById('startButton').addEventListener('click', startGame);
                document.getElementById('restartButton').addEventListener('click', startGame);
                document.getElementById('closeModalButton').addEventListener('click', hideModal);
                document.getElementById('withdrawButton').addEventListener('click', handleWithdrawal);
                
                // Keyboard controls
                document.addEventListener('keydown', (e) => {
                    if (!gameRunning) return;
                    switch(e.key) {
                        case 'ArrowUp': case 'w': player.moveDirection.up = true; break;
                        case 'ArrowDown': case 's': player.moveDirection.down = true; break;
                        case 'ArrowLeft': case 'a': player.moveDirection.left = true; break;
                        case 'ArrowRight': case 'd': player.moveDirection.right = true; break;
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    if (!gameRunning) return;
                    switch(e.key) {
                        case 'ArrowUp': case 'w': player.moveDirection.up = false; break;
                        case 'ArrowDown': case 's': player.moveDirection.down = false; break;
                        case 'ArrowLeft': case 'a': player.moveDirection.left = false; break;
                        case 'ArrowRight': case 'd': player.moveDirection.right = false; break;
                    }
                });
                
                // Mobile controls
                const controlButtons = document.querySelectorAll('#d-pad button');
                controlButtons.forEach(button => {
                    const dir = button.dataset.dir;
                    button.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        if (gameRunning) player.moveDirection[dir] = true;
                    });
                    button.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        if (gameRunning) player.moveDirection[dir] = false;
                    });
                    button.addEventListener('mousedown', () => {
                        if (gameRunning) player.moveDirection[dir] = true;
                    });
                    button.addEventListener('mouseup', () => {
                        if (gameRunning) player.moveDirection[dir] = false;
                    });
                });
            }
            
            function startGame() {
                console.log("Starting game...");
                // Reset game state
                score = 0;
                level = 1;
                sessionTokens = 0;
                bullets = [];
                coins = [];
                gameRunning = true;
                
                // Reset player position
                player.x = canvas.width / 2 - 20;
                player.y = canvas.height - 80;
                
                // Update UI
                document.getElementById('currentScore').textContent = score;
                document.getElementById('currentLevel').textContent = level;
                document.getElementById('sessionTokens').textContent = sessionTokens;
                document.getElementById('gameOverModal').classList.add('hidden');
                document.getElementById('startButton').textContent = 'RESTART';
                
                // Start game loop
                gameLoop();
            }
            
            function gameLoop() {
                if (!gameRunning) return;
                
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }
            
            function update() {
                // Move player
                if (player.moveDirection.left) player.x -= player.speed;
                if (player.moveDirection.right) player.x += player.speed;
                if (player.moveDirection.up) player.y -= player.speed;
                if (player.moveDirection.down) player.y += player.speed;
                
                // Keep player in bounds
                player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
                player.y = Math.max(0, Math.min(canvas.height - player.height, player.y));
                
                // Auto-shoot bullets
                if (Math.random() < 0.1) {
                    bullets.push({
                        x: player.x + player.width / 2,
                        y: player.y,
                        radius: 5,
                        speed: 8
                    });
                }
                
                // Spawn coins randomly
                if (Math.random() < 0.05 && coins.length < 10) {
                    coins.push({
                        x: Math.random() * (canvas.width - 30),
                        y: -30,
                        radius: 15,
                        speed: 2 + Math.random() * 2
                    });
                }
                
                // Update bullets
                for (let i = bullets.length - 1; i >= 0; i--) {
                    bullets[i].y -= bullets[i].speed;
                    
                    // Remove bullets that go off screen
                    if (bullets[i].y < -10) {
                        bullets.splice(i, 1);
                        continue;
                    }
                    
                    // Check bullet-coin collisions
                    for (let j = coins.length - 1; j >= 0; j--) {
                        const dx = bullets[i].x - coins[j].x;
                        const dy = bullets[i].y - coins[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < bullets[i].radius + coins[j].radius) {
                            // Hit!
                            score++;
                            document.getElementById('currentScore').textContent = score;
                            
                            // Award tokens every 5 points
                            if (score % 5 === 0) {
                                sessionTokens += 10;
                                document.getElementById('sessionTokens').textContent = sessionTokens;
                            }
                            
                            // Level up every 10 points
                            if (score % 10 === 0) {
                                level++;
                                document.getElementById('currentLevel').textContent = level;
                            }
                            
                            coins.splice(j, 1);
                            bullets.splice(i, 1);
                            break;
                        }
                    }
                }
                
                // Update coins
                for (let i = coins.length - 1; i >= 0; i--) {
                    coins[i].y += coins[i].speed;
                    
                    // Check if coin reached bottom (game over)
                    if (coins[i].y > canvas.height + 30) {
                        gameOver();
                        return;
                    }
                }
            }
            
            function draw() {
                // Clear canvas
                ctx.fillStyle = '#0b0f14';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw player (Bongo)
                ctx.fillStyle = '#38b000';
                ctx.fillRect(player.x, player.y, player.width, player.height);
                
                // Draw bullets
                ctx.fillStyle = '#ffcc00';
                bullets.forEach(bullet => {
                    ctx.beginPath();
                    ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // Draw coins
                coins.forEach(coin => {
                    ctx.fillStyle = '#ffcc00';
                    ctx.beginPath();
                    ctx.arc(coin.x, coin.y, coin.radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = '#e6b800';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.fillStyle = '#0b0f14';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('$', coin.x, coin.y);
                });
            }
            
            function gameOver() {
                gameRunning = false;
                
                // Update final score display
                document.getElementById('finalScore').textContent = score;
                document.getElementById('finalSessionTokens').textContent = sessionTokens;
                
                // Check for new high score
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('bongoHighScore', highScore);
                }
                
                // Save tokens
                totalTokens = parseInt(totalTokens) + sessionTokens;
                localStorage.setItem('bongoTotalTokens', totalTokens);
                document.getElementById('totalTokens').textContent = totalTokens;
                
                document.getElementById('newHighScore').textContent = highScore;
                document.getElementById('gameOverModal').classList.remove('hidden');
            }
            
            function handleWithdrawal() {
                const address = document.getElementById('solanaAddress').value;
                const amount = parseInt(document.getElementById('withdrawalAmount').value);
                const messageEl = document.getElementById('withdrawalMessage');
                
                if (!address) {
                    showMessage('Error', 'Please enter a wallet address');
                    return;
                }
                
                if (isNaN(amount) || amount < 100) {
                    showMessage('Error', 'Minimum withdrawal is 100 tokens');
                    return;
                }
                
                if (amount > totalTokens) {
                    showMessage('Error', 'Insufficient tokens');
                    return;
                }
                
                // Simulate withdrawal
                totalTokens -= amount;
                localStorage.setItem('bongoTotalTokens', totalTokens);
                document.getElementById('totalTokens').textContent = totalTokens;
                
                messageEl.textContent = `Withdrew ${amount} tokens!`;
                setTimeout(() => {
                    messageEl.textContent = '';
                }, 3000);
                
                showMessage('Success', `Withdrew ${amount} tokens to ${address}`);
            }
            
            function showMessage(title, body) {
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('modalBody').textContent = body;
                document.getElementById('messageModal').classList.remove('hidden');
            }
            
            function hideModal() {
                document.getElementById('messageModal').classList.add('hidden');
            }
            
            console.log("Game initialized successfully!");
        }
    </script>
</body>
</html>
